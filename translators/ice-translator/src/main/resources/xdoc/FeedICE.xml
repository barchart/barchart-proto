<protocol>

	<config info="protocol for ICE feed">
		<main class="com.barchart.translator.ice.xform.XFormICE" />
		<codec class="com.barchart.translator.ice.xform.CodecICE" />
		<converter class="com.barchart.translator.ice.xform.ConverterICE" />
		<import>com.barchart.proto.buf.*</import>
	</config>

	<record name="ICEPacket">
		<field name="head" type="PacketHead" />
		<field name="messageList" type="Message" list="true"
			counter="head.numberOfMessages()" />

		<convert type="Packet.Builder" name="packet">
			<into>
				<visit name="packet" />
			</into>
		</convert>
	</record>

	<record name="PacketHead" size="16">
		<field name="sessionNumber" type="int" codec="number" size="2"
			info="The session number is used so that a client can easily detect when a new session has started after the daily
maintenance window or failure on the server side. It should stay the same for a given multicast channel until a
new session has started." />

		<field name="sequenceNumber" type="long" codec="number" size="4"
			info="Each message is assigned a sequence number that increases monotonically on the server side. To save
bandwidth, the sequence number is a field in the block header, instead of every message. The sequence number
for the first message is used in the header, and the client is expected to derive the sequence numbers for
subsequent messages in the block." />

		<field name="numberOfMessages" type="int" codec="number" size="8"
			info="" />

		<field name="sentDateTime" type="long" codec="number" size="8"
			info="" />
			
		<convert type="Packet.Builder" name="packet">
			<into>
				packet.setSequence(sequenceNumber);
				packet.setTimeStamp(converter.timeStamp(sentDateTime));
			</into>
		</convert>	
	</record>
	
	
	<record name="Message">
		<field name="messageType" type="String" codec="string" size="1" />
		<field name="messageBodyLength" type="int" codec="number" size="2" /> 
	</record>

</protocol>